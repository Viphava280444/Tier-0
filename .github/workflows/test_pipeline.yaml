# .github/workflows/vm-access.yml

name: Test Pipeline

on:
  push:
    branches: [ "Pipeline" ]

jobs:
  access-to-virtual-machine:
    runs-on: ubuntu-latest
    
    steps:
    - name: Install tools
      run: sudo apt-get update && sudo apt-get install -y sshpass expect
    
    - name: Access to virtual machine
      env:
        SERVER1_HOST: ${{ secrets.SERVER1_HOST }}
        SERVER1_USER: ${{ secrets.SERVER1_USER }}
        SERVER1_PASS: ${{ secrets.SERVER1_PASS }}
        SERVER2_HOST: ${{ secrets.SERVER2_HOST }}
        SERVER2_USER: ${{ secrets.SERVER2_USER }}
        SERVER2_PASS: ${{ secrets.SERVER2_PASS }}
      run: |
        # Method 1: Use expect to handle SSH password prompts
        expect << EOF
        spawn ssh -o StrictHostKeyChecking=no $SERVER1_USER@$SERVER1_HOST
        expect "password:"
        send "$SERVER1_PASS\r"
        expect "$ "
        send "ssh -o StrictHostKeyChecking=no $SERVER2_USER@$SERVER2_HOST\r"
        expect "password:"
        send "$SERVER2_PASS\r"
        expect "$ "
        send "echo 'Connected to Server2' && hostname\r"
        expect "$ "
        send "alias\r"
        expect "$ "
        EOF