# .github/workflows/vm-access.yml

name: Test Pipeline

on:
  push:
    branches: [ "Pipeline" ]

jobs:
  access-to-virtual-machine:
    runs-on: ubuntu-latest
    
    steps:
    - name: Install sshpass
      run: sudo apt-get update && sudo apt-get install -y sshpass
    
    - name: Access to virtual machine
      env:
        SERVER1_HOST: ${{ secrets.SERVER1_HOST }}
        SERVER1_USER: ${{ secrets.SERVER1_USER }}
        SERVER1_PASS: ${{ secrets.SERVER1_PASS }}
        SERVER2_HOST: ${{ secrets.SERVER2_HOST }}
        SERVER2_USER: ${{ secrets.SERVER2_USER }}
        SERVER2_PASS: ${{ secrets.SERVER2_PASS }}
      run: |
        # Connect to Server1, then Server2
        sshpass -p "$SERVER1_PASS" ssh -o StrictHostKeyChecking=no $SERVER1_USER@$SERVER1_HOST \
        ssh 